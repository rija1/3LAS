"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.RtpSourceCallback = void 0;
const rx_mini_1 = __importDefault(require("rx.mini"));
const rtp_1 = require("../../rtp/rtp");
class RtpSourceCallback {
    constructor(options = {}) {
        Object.defineProperty(this, "options", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: options
        });
        Object.defineProperty(this, "cb", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        Object.defineProperty(this, "onStopped", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: new rx_mini_1.default()
        });
        Object.defineProperty(this, "input", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: (packet) => {
                const rtp = packet instanceof rtp_1.RtpPacket ? packet : rtp_1.RtpPacket.deSerialize(packet);
                if (this.options.payloadType != undefined &&
                    this.options.payloadType !== rtp.header.payloadType) {
                    if (this.options.clearInvalidPTPacket) {
                        rtp.clear();
                    }
                    return;
                }
                if (this.cb) {
                    this.cb({ rtp });
                }
            }
        });
        options.clearInvalidPTPacket = options.clearInvalidPTPacket ?? true;
    }
    pipe(cb) {
        this.cb = cb;
    }
    stop() {
        if (this.cb) {
            this.cb({ eol: true });
        }
        this.onStopped.execute();
        this.cb = undefined;
        this.onStopped.allUnsubscribe();
    }
}
exports.RtpSourceCallback = RtpSourceCallback;
//# sourceMappingURL=rtpCallback.js.map